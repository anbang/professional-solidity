# 21.Gas ä¼˜åŒ–

## 1ï¸âƒ£ çœé’±æ€»ç»“

- ä½¿ç”¨çŸ­è·¯æ¨¡å¼æ¥æ’åºæ“ä½œ
- å‡½æ•°ä½¿ç”¨`external` + `calldata`
  - å¯¹ `memory` ç±»å‹çš„å‚æ•°ï¼Œä½¿ç”¨ `external` å¹¶ä¸”å‚æ•°æ ‡æ³¨ `calldata` æ˜¯æœ€çœé’±çš„ã€‚
- ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹
  - gas ç”±å°åˆ°å¤§: å€¼ç±»å‹ `<` å¼•ç”¨ç±»å‹
- å¾ªç¯ä¸­ä¸æ“ä½œ `storage` å˜é‡
- å¾ªç¯ä¸­çš„ä¸é‡å¤è®¡ç®—æ•°æ®
  - èƒ½ä¸åœ¨å¾ªç¯ä¸­æ“ä½œçš„æ•°æ®ï¼Œå°±å°½é‡æ”¾åœ¨å¤–é¢è®¡ç®—
- å¤šä¸ªå¾ªç¯å¯ä»¥åˆå¹¶å°±å°½é‡åˆå¹¶.(å¾ªç¯å°½é‡ä¸ç”¨)
- å¯é¢„æµ‹çš„ç»“æœ,ä¸é€šè¿‡ä»£ç è®¡ç®—ã€‚
- é¿å…æ­»ä»£ç 
- é¿å…ä¸å¿…è¦çš„åˆ¤æ–­
- åˆ é™¤ä¸å¿…è¦çš„åº“
- å‡½æ•°ä¸­èƒ½ä¸ retrunï¼Œå°±å°½é‡ä¸ return
- åº“åˆçº¦ä½¿ç”¨ using for æ¯”ç›´æ¥ä½¿ç”¨æ›´çœ gas
- mapping çš„ key ä½¿ç”¨ bytes32ï¼Œè€Œä¸ä½¿ç”¨å­—ç¬¦ä¸²ï¼Œå¯ä»¥çœ Gasï¼›
- `private` å˜é‡æ¯” `public`å˜é‡æ›´èŠ‚çœ Gas

## 2ï¸âƒ£ ä½¿ç”¨çŸ­è·¯æ¨¡å¼æ¥æ’åºæ“ä½œ

çŸ­è·¯ï¼ˆshort-circuitingï¼‰æ˜¯åˆ©ç”¨é€»è¾‘æˆ–(`||`),é€»è¾‘ä¸(`&&`)çš„ç‰¹æ€§ï¼Œæ¥æ’åºä¸åŒæˆæœ¬æ“ä½œçš„å¼€å‘æ¨¡å¼ï¼›æ ¸å¿ƒæ˜¯ **å®ƒå°†ä½ gas æˆæœ¬çš„æ“ä½œæ”¾åœ¨å‰é¢ï¼Œé«˜ gas æˆæœ¬çš„æ“ä½œæ”¾åœ¨åé¢**ï¼›è¿™æ ·å¦‚æœå‰é¢çš„ä½æˆæœ¬æ“ä½œä¸å¯è¡Œï¼Œå°±å¯ä»¥è·³è¿‡ï¼ˆçŸ­è·¯ï¼‰åé¢çš„é«˜æˆæœ¬ä»¥å¤ªåŠæ“ä½œäº†ã€‚

- å‰é¢åˆ¤æ–­ä¸º trueï¼Œæ‰§è¡Œåé¢çš„æ¡ä»¶åˆ¤æ–­
- å‰é¢åˆ¤æ–­ä¸º falseï¼Œè·³è¿‡åé¢çš„æ¡ä»¶åˆ¤æ–­
  - è¿™æ ·å°±æŠŠåé¢æ¡ä»¶çš„è¿è¡Œ gas ç»™èŠ‚çœä¸‹æ¥äº†

```
// f(x) æ˜¯ä½gasæˆæœ¬çš„æ“ä½œ
// g(y) æ˜¯é«˜gasæˆæœ¬çš„æ“ä½œ

// æŒ‰å¦‚ä¸‹æ’åºä¸åŒgasæˆæœ¬çš„æ“ä½œ
f(x) || g(y)
f(x) && g(y)
```

è¿™é‡Œå“ªä¸ªåˆ¤æ–­åœ¨å‰é¢ï¼Œå“ªä¸ªåˆ¤æ–­åœ¨åé¢ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥å®‰æ’ã€‚

**ä¸‹é¢æ˜¯ä¾‹å­**è¯´æ˜,ä¸€ä¸ªéå¸¸ç®€å•çš„å€¼åˆ¤æ–­:

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ 1:   22050
    // è¾“å…¥ 2:   22065
    // è¾“å…¥ 101: 22050
    // è¾“å…¥ 102: 22055
    // å¹³å‡å€¼: (22050+22065+22050+22055)/4 = 22055
    function test1(uint256 _amount) external pure returns (bool) {
        bool isEven = _amount % 2 == 0;
        bool isLessThan99 = _amount < 99;
        if (isEven && isLessThan99) {
            return true;
        }
        return false;
    }

    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ 1:   22040
    // è¾“å…¥ 2:   22061
    // è¾“å…¥ 101: 22040
    // è¾“å…¥ 102: 22051
    // å¹³å‡å€¼: (22040+22061+22040+22051)/4 = 22048
    function test2(uint256 _amount) external pure returns (bool) {
        if (_amount % 2 == 0 && _amount < 99) {
            return true;
        }
        return false;
    }

    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ 1:   22073
    // è¾“å…¥ 2:   22083
    // è¾“å…¥ 101: 21881
    // è¾“å…¥ 102: 21881
    // å¹³å‡å€¼: (22073+22083+21881+21881)/4 = 21979.5 âœ… å¹³å‡å€¼æœ€ä½
    function test3(uint256 _amount) external pure returns (bool) {
        if (_amount < 99 && _amount % 2 == 0) {
            return true;
        }
        return false;
    }
}
```

## 3ï¸âƒ£ å‡½æ•°ä½¿ç”¨`external` + `calldata`

åœ¨åˆçº¦å¼€å‘ç§ï¼Œæ˜¾å¼å£°æ˜å‡½æ•°çš„å¯è§æ€§ä¸ä»…å¯ä»¥æé«˜æ™ºèƒ½åˆçº¦çš„å®‰å…¨æ€§ï¼ŒåŒæ—¶ä¹Ÿæœ‰åˆ©äºä¼˜åŒ–åˆçº¦æ‰§è¡Œçš„ gas æˆæœ¬ã€‚

ä¾‹å¦‚ï¼Œé€šè¿‡æ˜¾å¼åœ°æ ‡è®°å‡½æ•°ä¸ºå¤–éƒ¨å‡½æ•° `external`ï¼Œå¯ä»¥å¼ºåˆ¶å°†å‡½æ•°å‚æ•°çš„å­˜å‚¨ä½ç½®è®¾ç½®ä¸º calldataï¼Œè¿™ä¼šèŠ‚çº¦æ¯æ¬¡å‡½æ•°æ‰§è¡Œæ—¶æ‰€éœ€çš„ä»¥å¤ªåŠ gas æˆæœ¬ã€‚

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ a       :   22965
    // è¾“å…¥ abc     :   22989
    // è¾“å…¥ hello   :   23013
    // å¹³å‡å€¼: (22965+22989+23013)/3 = 22989
    function test1(string memory _str) public pure returns (string memory) {
        return _str;
    }

    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ a       :   22943
    // è¾“å…¥ abc     :   22967
    // è¾“å…¥ hello   :   22991
    // å¹³å‡å€¼: (22943+22967+22991)/3 = 22967
    function test2(string memory _str) external pure returns (string memory) {
        return _str;
    }

    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ a       :   22705
    // è¾“å…¥ abc     :   22729
    // è¾“å…¥ hello   :   22753
    // å¹³å‡å€¼: (22705+22729+22753)/3 = 22729 âœ… å¹³å‡å€¼æœ€ä½
    function test3(string calldata _str) external pure returns (string memory) {
        return _str;
    }
}
```

æ³¨æ„è¿™ç§æ–¹æ³•åªå¯¹ `memory` ç±»å‹çš„æ•°æ®æœ‰æ•ˆï¼Œå¦‚æœæ˜¯æ“ä½œæ™®é€šçš„ç±»å‹ï¼Œå¯è§æ€§æ²¡æœ‰å½±å“ã€‚å¦‚ä¸‹ä¾‹å­æˆ‘å°†ä¸Šé¢çŸ­è·¯æ“ä½œä¾‹å­ä¸­ `external` æ”¹ä¸º `public`,æ‰€æ¶ˆè€—çš„ gas å¹¶æ²¡æœ‰ä»»ä½•å½±å“

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ 1:   22050  | æ”¹ä¸º public å: 22050
    // è¾“å…¥ 2:   22065  | æ”¹ä¸º public å: 22065
    // è¾“å…¥ 101: 22050  | æ”¹ä¸º public å: 22050
    // è¾“å…¥ 102: 22055  | æ”¹ä¸º public å: 22055
    // å¹³å‡å€¼: (22050+22065+22050+22055)/4 = 22055
    function test1(uint256 _amount) public pure returns (bool) {
        bool isEven = _amount % 2 == 0;
        bool isLessThan99 = _amount < 99;
        if (isEven && isLessThan99) {
            return true;
        }
        return false;
    }

    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ 1:   22040  | æ”¹ä¸º public å: 22040
    // è¾“å…¥ 2:   22061  | æ”¹ä¸º public å: 22061
    // è¾“å…¥ 101: 22040  | æ”¹ä¸º public å: 22040
    // è¾“å…¥ 102: 22051  | æ”¹ä¸º public å: 22051
    // å¹³å‡å€¼: (22040+22061+22040+22051)/4 = 22048
    function test2(uint256 _amount) public pure returns (bool) {
        if (_amount % 2 == 0 && _amount < 99) {
            return true;
        }
        return false;
    }

    // gaså€¼å¦‚ä¸‹
    // è¾“å…¥ 1:   22073  | æ”¹ä¸º public å: 22073
    // è¾“å…¥ 2:   22083  | æ”¹ä¸º public å: 22083
    // è¾“å…¥ 101: 21881  | æ”¹ä¸º public å: 21881
    // è¾“å…¥ 102: 21881  | æ”¹ä¸º public å: 21881
    // å¹³å‡å€¼: (22073+22083+21881+21881)/4 = 21979.5 âœ… å¹³å‡å€¼æœ€ä½
    function test3(uint256 _amount) public pure returns (bool) {
        if (_amount < 99 && _amount % 2 == 0) {
            return true;
        }
        return false;
    }
}
```

## 4ï¸âƒ£ ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹

æœ‰äº›æ•°æ®ç±»å‹è¦æ¯”å¦å¤–ä¸€äº›æ•°æ®ç±»å‹çš„ gas æˆæœ¬é«˜ã€‚æˆ‘ä»¬æœ‰å¿…è¦äº†è§£å¯ç”¨æ•°æ®ç±»å‹çš„ gas åˆ©ç”¨æƒ…å†µï¼Œä»¥ä¾¿æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©æ•ˆç‡æœ€é«˜çš„é‚£ç§ã€‚ä¸‹é¢æ˜¯å…³äºæ•°æ®ç±»å‹ gas æ¶ˆè€—æƒ…å†µçš„ä¸€äº›è§„åˆ™ï¼š

- åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ `uint256` ç±»å‹çš„æƒ…å†µä¸‹ï¼Œä¸è¦ä½¿ç”¨ `string` ç±»å‹
- å­˜å‚¨ `uint256` è¦æ¯”å­˜å‚¨ `uint8` çš„ gas æˆæœ¬ä½ï¼Œä¸ºä»€ä¹ˆï¼Ÿç‚¹å‡»è¿™é‡Œ [æŸ¥çœ‹åŸæ–‡](https://ethereum.stackexchange.com/questions/3067/why-does-uint8-cost-more-gas-than-uint256)
- å½“å¯ä»¥ä½¿ç”¨ `bytes32` ç±»å‹æ—¶ï¼Œä¸è¦ä½¿ç”¨` byte[]` ç±»å‹
- å¦‚æœ `bytes32` çš„é•¿åº¦æœ‰å¯ä»¥é¢„è®¡çš„ä¸Šé™ï¼Œé‚£ä¹ˆå°½å¯èƒ½æ”¹ç”¨ `bytes1`~`bytes32` è¿™äº›å…·æœ‰å›ºå®šé•¿åº¦çš„ç±»å‹
- `bytes32` æ‰€éœ€çš„ gas æˆæœ¬è¦ä½äº `string` ç±»å‹
- `bool > unit256 > uint8 > bytes1 > bytes32 > bytes > string`

### å­˜å‚¨å¯¹æ¯”

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    uint256 public test3 = 0; // 23494
    uint8 public test1 = 0; // 23554
    bool public test2 = false; // 23630
    bytes1 public test4 = 0x30; // 23601
    // 23516
    bytes32 public test5 =
        0x3000000000000000000000000000000000000000000000000000000000000000;
    string public test7 = "0"; // 24487
    bytes public test6 = bytes("0"); // 24531
}
```

### è¿”å›å¯¹æ¯”

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    // uint256 :21415
    function test1() external pure returns (uint256) {
        return 0;
    }

    // uint8 : 21444
    function test2() external pure returns (uint8) {
        return 0;
    }

    // bool :21400
    function test3() external pure returns (bool) {
        return false;
    }

    // bytes1 :21479
    function test4() external pure returns (bytes1) {
        return 0x30;
    }

    // bytes32 :21430
    function test5() external pure returns (bytes32) {
        return
            0x3000000000000000000000000000000000000000000000000000000000000000;
    }

    // bytes :21845
    function test6() external pure returns (bytes memory) {
        return bytes("0");
    }

    // string :21801
    function test7() external pure returns (string memory) {
        return "0";
    }
}
```

## 5ï¸âƒ£ å¾ªç¯ä¸­ä¸æ“ä½œ `storage` å˜é‡

ç®¡ç† storage å˜é‡çš„ gas æˆæœ¬è¦è¿œè¿œé«˜äºå†…å­˜å˜é‡ï¼Œæ‰€ä»¥è¦é¿å…åœ¨å¾ªç¯ä¸­æ“ä½œ storage å˜é‡ã€‚

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    uint256 public num = 0;

    // è¾“å…¥ 5 : 46475 gas
    function test1(uint256 x) public {
        for (uint256 i = 0; i < x; i++) {
            num += 1;
        }
    }

    // è¾“å…¥ 5 : 45651 gas
    function test2(uint256 x) public {
        uint256 temp = num;
        for (uint256 i = 0; i < x; i++) {
            temp += 1;
        }
        num = temp;
    }
}
```

## 6ï¸âƒ£ å¾ªç¯ä¸­çš„ä¸é‡å¤è®¡ç®—æ•°æ®

- èƒ½ä¸åœ¨å¾ªç¯ä¸­æ“ä½œçš„æ•°æ®ï¼Œå°±å°½é‡æ”¾åœ¨å¤–é¢è®¡ç®—

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    uint256 a = 4;
    uint256 b = 5;

    function repeatedComputations(uint256 x) public view returns (uint256) {
        uint256 sum = 0;
        for (uint256 i = 0; i <= x; i++) {
            sum = sum + a * b;
        }
    }
}

```

## 7ï¸âƒ£ å°½é‡å°‘ç”¨å¾ªç¯

**å¤šä¸ªå¾ªç¯å¯ä»¥åˆå¹¶å°±å°½é‡åˆå¹¶ï¼Œå¾ªç¯å°½é‡ä¸ç”¨**

æœ‰æ—¶å€™åœ¨ Solidity æ™ºèƒ½åˆçº¦ä¸­ï¼Œä½ ä¼šå‘ç°ä¸¤ä¸ªå¾ªç¯çš„åˆ¤æ–­æ¡ä»¶ä¸€è‡´ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹å°±æ²¡æœ‰ç†ç”±ä¸åˆå¹¶å®ƒä»¬ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»¥å¤ªåŠåˆçº¦ä»£ç ï¼š

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    function loopFusion(uint256 x, uint256 y) public pure returns (uint256) {
        for (uint256 i = 0; i < 100; i++) {
            x += 1;
        }
        for (uint256 i = 0; i < 100; i++) {
            y += 1;
        }
        return x + y;
    }
}
```

## 8ï¸âƒ£ å¯é¢„æµ‹çš„ç»“æœ,ä¸é€šè¿‡ä»£ç è®¡ç®—ã€‚

å¦‚æœä¸€ä¸ªå¾ªç¯è®¡ç®—çš„ç»“æœæ˜¯æ— éœ€ç¼–è¯‘æ‰§è¡Œä»£ç å°±å¯ä»¥é¢„æµ‹çš„ï¼Œé‚£ä¹ˆå°±ä¸è¦ä½¿ç”¨å¾ªç¯ï¼Œè¿™å¯ä»¥å¯è§‚åœ°èŠ‚çœ gasã€‚

ä¾‹å¦‚ä¸‹é¢çš„ä»¥å¤ªåŠåˆçº¦ä»£ç å°±å¯ä»¥ç›´æ¥è®¾ç½® num å˜é‡çš„å€¼ï¼š

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Demo {
    function constantOutcome() public pure returns (uint256) {
        uint256 num = 0;
        for (uint256 i = 0; i < 100; i++) {
            num += 1;
        }
        return num;
    }
}

```

## 9ï¸âƒ£ é¿å…æ­»ä»£ç 

æ­»ä»£ç ï¼ˆDead codeï¼‰æ˜¯æŒ‡é‚£äº›æ°¸è¿œä¹Ÿä¸ä¼šæ‰§è¡Œçš„ Solidity ä»£ç ï¼Œä¾‹å¦‚é‚£äº›æ‰§è¡Œæ¡ä»¶æ°¸è¿œä¹Ÿä¸å¯èƒ½æ»¡è¶³çš„ä»£ç ï¼Œå°±åƒä¸‹é¢çš„ä¸¤ä¸ªè‡ªç›¸çŸ›ç›¾çš„æ¡ä»¶åˆ¤æ–­é‡Œçš„ä»£ç å—ï¼Œæ¶ˆè€—äº†ä»¥å¤ªåŠ gas èµ„æºä½†æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼š

```
if (x < 1) {
    if (x > 2) {
        return x;
    }
}
```

## ğŸ”Ÿ é¿å…ä¸å¿…è¦çš„åˆ¤æ–­

æœ‰äº›æ¡ä»¶æ–­è¨€çš„ç»“æœä¸éœ€è¦ä»£ç çš„æ‰§è¡Œå°±å¯ä»¥äº†è§£ï¼Œé‚£ä¹ˆè¿™æ ·çš„æ¡ä»¶åˆ¤æ–­å°±å¯ä»¥ç²¾ç®€æ‰ã€‚ä¾‹å¦‚ä¸‹é¢çš„ Solidity åˆçº¦ä»£ç ä¸­çš„ä¸¤çº§åˆ¤æ–­æ¡ä»¶ï¼Œæœ€å¤–å±‚çš„åˆ¤æ–­æ˜¯åœ¨æµªè´¹å®è´µçš„ä»¥å¤ªåŠ gas èµ„æºï¼š

```
 if(x < 1) {
    if(x < 0) {
      return x;
    }
  }
```

## 1ï¸âƒ£ åˆ é™¤ä¸å¿…è¦çš„åº“

åœ¨å¼€å‘ Solidity æ™ºèƒ½åˆçº¦æ—¶ï¼Œæˆ‘ä»¬å¼•å…¥çš„åº“é€šå¸¸åªéœ€è¦ç”¨åˆ°å…¶ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å…¶ä¸­å¯èƒ½ä¼šåŒ…å«å¤§é‡å¯¹äºæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦è€Œè¨€æ˜¯å†—ä½™ä»£ç ã€‚å¦‚æœå¯ä»¥åœ¨è‡ªå·±çš„åˆçº¦é‡Œå®‰å…¨æœ‰æ•ˆåœ°å®ç°æ‰€ä¾èµ–çš„åº“åŠŸèƒ½ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿè¾¾åˆ°ä¼˜åŒ–åˆçº¦çš„ gas åˆ©ç”¨çš„ç›®çš„ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ solidity ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„ä»¥å¤ªåŠåˆçº¦åªæ˜¯ç”¨åˆ°äº† SafeMath åº“çš„ add æ–¹æ³•ï¼š

```
import './SafeMath.sol' as SafeMath;

contract SafeAddition {
  function safeAdd(uint a, uint b) public pure returns(uint) {
    return SafeMath.add(a, b);
  }
}
```

```
contract SafeAddition {
  function safeAdd(uint a, uint b) public pure returns(uint) {
    uint c = a + b;
    require(c >= a, "Addition overflow");
    return c;
  }
}
```

## ğŸ†— ä¼˜åŒ–æ¡ˆä¾‹

æœ¬ç¯‡ä¸»è¦ä»‹ç» gas çš„ä¼˜åŒ–ã€‚

- å‡½æ•°è¾“å…¥å‚æ•°:ä½¿ç”¨ `calldata` ï¼Œä¸ä½¿ç”¨ `memory`ã€‚
- è¯»å–çŠ¶æ€å˜é‡:ä½¿ç”¨ã€‚
- ä½¿ç”¨æ•°ç»„æ—¶å€™:
  - for å¾ªç¯æ—¶ï¼Œç¼“å­˜æ•°ç»„é•¿åº¦
  - å‚¨å­˜æ•°ç»„çš„å…ƒç´ åˆ° `memory`ã€‚
- short circuit: `&&` çŸ­è·¯æ“ä½œ
  - `A && B`,A è¡¨è¾¾å¼ ä¸æˆç«‹ï¼Œåˆ™ä¸è®¡ç®— B è¡¨è¾¾å¼
- loop increments

ä¸‹é¢é»˜è®¤çš„ Gas æ˜¯ 50518 gas

**åŸå§‹ä»£ç :**

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Gas {
    uint256 public total;

    // [1,2,3,4,5,100]
    function demo(uint256[] memory nums) external {
        for (uint256 index = 0; index < nums.length; index++) {
            bool isEven = nums[index] % 2 == 0;
            bool isLessThan99 = nums[index] < 99;
            if (isEven && isLessThan99) {
                total += nums[index];
            }
        }
    }
}
/**
  * é»˜è®¤: 50518 gas
  */
```

**ä¼˜åŒ–å**

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Gas {
    uint256 public total;

    // [1,2,3,4,5,100]
    function demo(uint256[] calldata nums) external {
        uint256 _total = total;
        uint256 len = nums.length;
        for (uint256 index = 0; index < len; ++index) {
            uint256 num = nums[index];
            if (num % 2 == 0 && num < 99) {
                _total += num;
            }
        }
        total = _total;
    }
}

/**
 * é»˜è®¤ => 50518 gas
 * 1. å‡½æ•°å‚æ•°ä¸ä½¿ç”¨ memoryï¼Œæ”¹ç”¨ calldata
 *      => 48773    èŠ‚çœäº† 1745
 * 2. çŠ¶æ€å˜é‡åœ¨å‡½æ•°å†…ä¸æ¯æ¬¡éƒ½è¯»å–å’Œä¿®æ”¹ï¼Œç¼“å­˜åˆ°å†…å­˜é‡Œï¼Œç»Ÿä¸€ä¿®æ”¹
 *      => 48562    èŠ‚çœäº† 211
 * 3. çŸ­è·¯(æ¡ä»¶ &&)
 *      => 48244    èŠ‚çœäº† 318
 * 4. å¾ªç¯å¢é‡ i++ æ”¹ä¸º ++i
 *      => 48214    èŠ‚çœäº† 30
 * 5. å¾ªç¯æ—¶ï¼Œç¼“å­˜æ•°ç»„çš„é•¿åº¦ uint256 len = nums.length;
 *      => 48179    èŠ‚çœäº† 35
 * 6. æ•°ç»„çš„å…ƒç´ ï¼Œæå‰ç¼“å­˜ï¼Œä¸é‡å¤è¯»å–
 *      => 48017    èŠ‚çœäº† 162
 *
 */
```
