# 22.åˆçº¦ç¼–ç è§„èŒƒ

è‰¯å¥½ç»Ÿä¸€çš„ç¼–ç¨‹é£æ ¼ï¼Œæœ‰åŠ©äºæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ ¹æ®é£æ ¼æ•´ç†æˆè§„èŒƒï¼Œå¯ä»¥è®©å›¢é˜Ÿä¹‹é—´æ›´å¥½çš„é…åˆã€‚

ä¸‹é¢æ˜¯æˆ‘ç»“åˆç½‘ç»œä¸Šåˆ«äººåˆ†äº«çš„å†…å®¹ï¼Œä»¥åŠå‚è€ƒ Vscode ä»£ç æ ¼å¼åŒ–æ•´ç†ä¼˜åŒ–å‡ºçš„ï¼›æŠ›ç –å¼•ç‰ï¼Œä»…ä¾›å‚è€ƒã€‚

- å¦‚æœåˆçº¦å¯¹çŠ¶æ€å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œéœ€è¦æŠ›å‡ºäº‹ä»¶ã€‚
- æ„é€ å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯`storage`æˆ–`memory`ï¼Œä¸èƒ½ä½¿ç”¨`calldata`;
- ç‰ˆæƒæ³¨é‡Šåœ¨æ–‡ä»¶çš„ä»»ä½•ä½ç½®éƒ½å¯ä»¥è¢«ç¼–è¯‘å™¨è¯†åˆ«ï¼Œä½†å»ºè®®æŠŠå®ƒæ”¾åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ç¬¬ä¸€è¡Œã€‚

## 1ï¸âƒ£ ä»£ç å¸ƒå±€

- æºç ç¼–ç 
  - UTF-8
- ç¼©è¿›
  - ä½¿ç”¨ 4 ä¸ªç©ºæ ¼ä»£æ›¿åˆ¶è¡¨ç¬¦ä½œä¸ºç¼©è¿›ï¼Œé¿å…ç©ºæ ¼ä¸åˆ¶è¡¨ç¬¦æ··ç”¨ã€‚
- 2 ä¸ªåˆçº¦å®šä¹‰ä¹‹é—´ç©º 2 è¡Œã€‚

  ```
  pragma solidity ^0.5.0;

  contract LedgerBalance {
      //...
  }


  contract Updater {
      //...
  }
  ```

- 2 ä¸ªå‡½æ•°ä¹‹é—´ç©º 1 è¡Œ,åœ¨åªæœ‰å£°æ˜çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ç©ºè¡Œã€‚

  ```
  pragma solidity ^0.5.0;

  contract A {
      function balance() public pure;
      function account() public pure;
  }


  contract B is A {
      function balance() public pure {
          // ...
      }

      function account() public pure {
          // ...
      }
  }
  ```

- å•è¡Œä¸è¦å¤ªé•¿ï¼ŒVScode ä¸€è¡Œé»˜è®¤ä¸è¶…è¿‡ 80 ä¸ªå­—ç¬¦ã€‚
- å‡½æ•°å£°æ˜å¦‚æœå¤ªé•¿ï¼Œå·¦æ‹¬å·ä¸æ¢è¡Œï¼Œæ¯ä¸ªå‚æ•°ä¸€è¡Œå¹¶ç¼©è¿›ï¼Œå³æ‹¬å·æ¢è¡Œï¼Œå¹¶å¯¹é½å·¦æ‹¬å·æ‰€åœ¨è¡Œã€‚

  ```
  function_with_a_long_name(
      longArgument1,
      longArgument2,
      longArgument3
  );

  variable = function_with_a_long_name(
      longArgument1,
      longArgument2,
      longArgument3
  );

  event multipleArguments(
      address sender,
      address recipient,
      uint256 publicKey,
      uint256 amount,
      bytes32[] options
  );

  MultipleArguments(
      sender,
      recipient,
      publicKey,
      amount,
      options
  );
  ```

- é¿å…åœ¨åœ†æ‹¬å·ã€æ–¹æ‹¬å·æˆ–å¤§æ‹¬å·åæœ‰ç©ºæ ¼ã€‚
- æ§åˆ¶ç»“æ„çš„å¤§æ‹¬å·å·¦æ‹¬å·ä¸æ¢è¡Œï¼Œå³æ‹¬å·æ¢è¡Œï¼Œä¸å·¦æ‹¬å·æ‰€åœ¨è¡Œå¯¹é½ã€‚

  ```
  pragma solidity ^0.5.0;

  contract Coin {
      struct Bank {
          address owner;
          uint balance;
      }
  }


  if (x < 3) {
      x += 1;
  } else if (x > 7) {
      x -= 1;
  } else {
      x = 5;
  }
  if (x < 3)
      x += 1;
  else
      x -= 1;
  ```

- å‡½æ•°å£°æ˜ï¼Œæ·»åŠ å¯è§æ€§æ ‡ç­¾ã€‚å¯è§æ€§æ ‡ç­¾åº”è¯¥æ”¾åœ¨è‡ªå®šä¹‰ä¿®é¥°ç¬¦ä¹‹å‰ã€‚

  ```
  function kill() public onlyowner {
      selfdestruct(owner);
  }
  ```

- å£°æ˜æ˜ å°„å˜é‡æ—¶é¿å…å¤šä½™ç©ºæ ¼ã€‚

  ```
  mapping(uint => uint) map; // ä¸æ˜¯ mapping (uint => uint) map;
  mapping(address => bool) registeredAddresses;
  mapping(uint => mapping(bool => Data[])) public data;
  mapping(uint => mapping(uint => s)) data;
  ```

- å£°æ˜æ•°ç»„å˜é‡æ—¶é¿å…å¤šä½™ç©ºæ ¼ã€‚

  ```
  uint[] x;  // ä¸æ˜¯ unit [] x;
  ```

- å­—ç¬¦ä¸²å£°æ˜,ä½¿ç”¨åŒå¼•å·å£°æ˜å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å•å¼•å·ã€‚

  ```
  str = "foo";
  str = "Hamlet says, 'To be or not to be...'";
  ```

## 2ï¸âƒ£ ä»£ç ä¸­å„éƒ¨åˆ†çš„é¡ºåº

ä»£ç ä¸­å„éƒ¨åˆ†é¡ºåºå¦‚ä¸‹ï¼š

1. License
2. Pragma
3. import
4. interface
5. library
6. contract

åœ¨ Interfaceã€åº“æˆ– Contract ä¸­ï¼Œå„éƒ¨åˆ†é¡ºåºåº”ä¸ºï¼š

1. Type declaration : ç±»å‹å£°æ˜
2. State variable : çŠ¶æ€å˜é‡
3. Event : äº‹ä»¶
4. Modifier : å‡½æ•°ä¿®æ”¹å™¨
5. Errors : è‡ªå®šä¹‰é”™è¯¯
6. Constructor : æ„é€ å‡½æ•°
7. Function : å‡½æ•°

   1. å‡½æ•°æŒ‰**visibility:å¯è§æ€§**è¿›è¡Œæ’åº: `External - Public - Internal - Private`
   2. åŒä¸€å¯è§æ€§ï¼ŒæŒ‰ç…§ **mutability:çŠ¶æ€å¯å˜æ€§** æ’åº: `payable - æ—  - view - pure`

   ```
   // External functions
   // ...

   // External view functions
   // ...

   // External pure functions
   // ...

   // Public functions
   // ...

   // Internal functions
   // ...

   // Private functions
   // ...
   ```

8. Helper : è¾…åŠ©å‡½æ•°

## 3ï¸âƒ£ æ–‡ä»¶ç»“æ„åˆ†äº«

æˆ‘çš„æ–‡ä»¶ç»“æ„ï¼Œåˆ†äº«ç»™å¤§å®¶ï¼Œä»…ä¾›å‚è€ƒï¼ŒæŠ›ç –å¼•ç‰ã€‚ä»£ç å—åˆ†å‰²ä¸»è¦æ˜¯è®©åˆçº¦çš„é€»è¾‘æ›´æ¸…æ™°ï¼Œå›¢é˜Ÿåˆä½œå†™ä»£ç çš„æ—¶å€™ï¼Œéƒ½èƒ½æŒ‰ç…§ç»Ÿä¸€çš„çº¦å®šæ¥è¿›è¡Œç¼–ç ã€‚

ä¸åŒåŠŸèƒ½çš„ä»£ç å—ä½¿ç”¨ä¸‹é¢ä»»æ„ä¸€ç§åšæ˜æ˜¾æ ‡è®°ã€‚

ç¬¬ä¸€ç§ï¼š

```
/*
  * ========================================
  * State Variables
  * ========================================
  */
```

ç¬¬äºŒç§ï¼š(ä¸¤è¾¹å„ 12 ä¸ª `=`)

```
/* ============ State Variables ============ */
```

å¦‚æœéœ€è¦å†™è¯¦ç»†çš„ NetSpec æ³¨é‡Šï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ä½¿ç”¨ç¬¬ä¸€ç§ã€‚å¦‚æœæ˜¯ä¸éœ€è¦è¿™æ ·åšï¼Œæ¯”è¾ƒå–œæ¬¢ç¬¬äºŒç§ã€‚ç¬¬ä¸€ç§å†™æ³•ï¼Œåœ¨ç¬¬ä¸€ç« [åŒå¿—ä»¬å¥½](/source/01.hello.html#id40) é‚£é‡Œå·²ç»æ¼”ç¤ºè¿‡äº†ï¼Œè¿™é‡Œæ¼”ç¤ºç¬¬äºŒç§å†™æ³•ã€‚å¦‚ä¸‹æ˜¯å†™æ³•çš„æ¼”ç¤ºï¼š

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

// import

// interface

// library

contract Demo {
    /* ============ Type Declaration ============ */
    struct Book {
        string title;
        string author;
        uint256 book_id;
    }

    /* ============ State Variables ============ */
    address public immutable owner;
    Book[] public bookcase;

    /* ============ Events ============ */
    event Hello(string);

    /* ============ Modifier ============ */
    modifier onlyOwner() {
        require(msg.sender == owner, "Only owner");
        _;
    }

    /* ============ Errors ============ */
    error MyError(string);

    /* ============ Constructor ============ */
    constructor() {
        owner = msg.sender;
    }

    /* ============ Functions ============ */

    /* ============ External Functions ============ */
    function hello() external onlyOwner {
        emit Hello("Hello Comrades");
    }

    /* ============ Helper ============ */
    function getBalance() external view returns (uint256) {
        return address(this).balance;
    }
}
```

## 4ï¸âƒ£ å‘½åçº¦å®š

- åˆçº¦å’Œåº“å: å¤§é©¼å³°å¼å‘½åã€‚

  ```
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.17;

  contract Owned {
      //...
  }
  ```

- åˆçº¦å’Œåº“å: åŒ¹é…å®ƒä»¬çš„æ–‡ä»¶åã€‚

  ```
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.17;

  // æ–‡ä»¶å:Owned.sol
  contract Owned {
      //...
  }
  ```

- å¦‚æœæ–‡ä»¶ä¸­æœ‰å¤šä¸ªåˆçº¦/åº“ï¼Œä½¿ç”¨æ ¸å¿ƒåˆçº¦/åº“çš„åç§°ã€‚ğŸ¤”ï¸

  ```
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.17;

  // æ–‡ä»¶å:Owned.sol
  contract Owned {
      address public owner;

      constructor() public {
          owner = msg.sender;
      }

      modifier onlyOwner() {
          //....
          _;
      }

      function transferOwnership(address newOwner) public onlyOwner returns(true){
          //...
          return true;
      }
  }
  ```

  ```
  // SPDX-License-Identifier: MIT
  pragma solidity ^0.8.17;

  import "./Owned.sol";

  // Congress.sol
  contract Congress is Owned {
  //...
  }
  ```

- ç»“æ„ä½“åç§°: å¤§é©¼å³°å¼å‘½åã€‚
  ```
  struct BookInfo {
      string title;
      string author;
      uint256 book_id;
  }
  ```
- äº‹ä»¶åç§°: å¤§é©¼å³°å¼å‘½å
  ```
  event AfterTransfer(address ads);
  ```
- å‡½æ•°å: å°é©¼å³°å‘½å
  ```
  function balanceOf(address account) external view returns (uint256){};
  ```
- `internal`å‡½æ•°å:`_`+å°é©¼å³°å‘½å
  ```
  function _grantRole(address _ads, bytes32 _role) internal {}
  ```
- `internal`å˜é‡:`_`+å°é©¼å³°
- å‡½æ•°å‚æ•°:å°é©¼å³°+`_`
  ```
  constructor(string memory name_, string memory symbol_) {
      _name = name_;
      _symbol = symbol_;
  }
  ```
- å±€éƒ¨å˜é‡å’ŒçŠ¶æ€å˜é‡:å°é©¼å³°å‘½å
  ```
  mapping(address => uint256) public balanceOf;
  ```
- å¸¸é‡:å¤§å†™å­—æ¯å•è¯ç”¨ä¸‹åˆ’çº¿åˆ†éš”ã€‚
  ```
  address public constant MIN_BLOCKS;
  ```
- å‡½æ•°ä¿®æ”¹å™¨: å°é©¼å³°å‘½å
  ```
  modifier onlyOwner(){
      require(msg.sender==owner,"must owner address");
      _;
  }
  ```
- æšä¸¾çš„åå­—:å¤§é©¼å³°å¼å‘½å
  ```
  enum Status {
      None,
      Pending,
      Shiped,
      Completed,
      Rejected,
      Canceled
  }
  ```

## 5ï¸âƒ£ æ›´å¤šå†…å®¹

é‡è¦éœ€è¦æ€»ç»“çš„å†…å®¹:

https://docs.soliditylang.org/zh/latest/style-guide.html
