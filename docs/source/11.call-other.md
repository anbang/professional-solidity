# 11.åˆçº¦è°ƒç”¨åˆçº¦

Solidity æ”¯æŒä¸€ä¸ªåˆçº¦è°ƒç”¨å¦ä¸€ä¸ªåˆçº¦ã€‚ä¸¤ä¸ªåˆçº¦æ—¢å¯ä»¥ä½äºåŒä¸€æ–‡ä»¶å†…ï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒçš„ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚è¿˜èƒ½è°ƒç”¨å·²ç»ä¸Šé“¾çš„å…¶å®ƒåˆçº¦ã€‚

- è°ƒç”¨å†…éƒ¨åˆçº¦
  - å†…éƒ¨åˆçº¦æŒ‡ï¼šä½äºåŒä¸€ sol æ–‡ä»¶ä¸­çš„åˆçº¦ï¼Œå®ƒä»¬ä¸éœ€è¦é¢å¤–çš„å£°æ˜å°±å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚
- è°ƒç”¨å¤–éƒ¨åˆçº¦
  - å¤–éƒ¨åˆçº¦æŒ‡ï¼šä½äºä¸åŒæ–‡ä»¶çš„å¤–éƒ¨åˆçº¦ï¼Œä»¥åŠä¸Šé“¾çš„åˆçº¦ã€‚
  - æ–¹æ³•ä¸€: é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨
  - æ–¹æ³•äºŒ: é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨

äº†è§£ä¸Šé¢çš„è°ƒç”¨åï¼Œå¯ä»¥æ‰©å±•äº†è§£**å¤šæ¬¡è°ƒç”¨**

## 1ï¸âƒ£ è°ƒç”¨å†…éƒ¨åˆçº¦

åœ°å€è½¬æ¢ä¸ºåˆçº¦å¯¹è±¡çš„é˜²èŒƒï¼š

- **æ–¹æ³• 1**: é€šè¿‡ `ContractName(_ads)` å°†ä¼ å…¥çš„åœ°å€ï¼Œè½¬ä¸ºåˆçº¦å¯¹è±¡
  - `Test(_ads).setX(_x);`
  - å¦‚æœä¸ºäº†ä»£ç é€»è¾‘ï¼Œä¹Ÿå¯ä»¥åˆ†å¼€å†™ï¼Œæ¯”å¦‚
    ```
    Test temp = Test(_ads);
    temp.setX(_x);
    ```
- **æ–¹æ³• 2**: å¯ä»¥é€šè¿‡å‚æ•°ä¸­æŒ‡å®šåˆçº¦åå­—è¿›è¡Œè½¬æ¢
  ```
    function setX2(Test _ads, uint256 _x) public {
        _ads.setX(_x);
    }
  ```
- **è°ƒç”¨å¹¶å‘é€ ETH**: `fnName{value: msg.value}();`
  - `Test(_ads).setYBySendEth{value: msg.value}();`

ä¾‹å­æ¼”ç¤ºï¼š

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Test {
    uint256 public x = 1;
    uint256 public y = 2;

    function setX(uint256 _x) public {
        x = _x;
    }

    function getX() public view returns (uint256) {
        return x;
    }

    function setYBySendEth() public payable {
        y = msg.value;
    }

    function getXandY() public view returns (uint256, uint256) {
        return (x, y);
    }
}

contract CallTest {
    // ç¬¬1ç§æ–¹æ³•: 229647 / 27858 gas
    function setX1(address _ads, uint256 _x) public {
        Test(_ads).setX(_x);
    }

    // ç¬¬2ç§æ–¹æ³•:   27923 gas
    function setX2(Test _ads, uint256 _x) public {
        _ads.setX(_x);
    }

    function getX(address _ads) public view returns (uint256) {
        return Test(_ads).getX();
    }

    function setYBySendEth(address _ads) public payable {
        Test(_ads).setYBySendEth{value: msg.value}();
    }

    function getXandY(address _ads)
        public
        view
        returns (uint256 __x, uint256 __y)
    {
        (__x, __y) = Test(_ads).getXandY();
    }
}
```

## 2ï¸âƒ£ è°ƒç”¨å¤–éƒ¨åˆçº¦

### 1. é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨

[æ¥å£ä½¿ç”¨æ¡ˆä¾‹](/source/13.interface.html#id3)

æ ¸å¿ƒä»£ç 

```
interface AnimalEat {
    function eat() external returns (string memory);
}

contract Animal {
    function test(address _addr) external returns (string memory) {
        AnimalEat general = AnimalEat(_addr);
        return general.eat();
    }
}
```

### 2. é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨

é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨åˆçº¦ï¼Œåªéœ€è¦ä¼ å…¥è¢«è°ƒç”¨è€…çš„åœ°å€å’Œè°ƒç”¨æ–¹æ³•å£°æ˜ã€‚

åœ¨ç¬¬äºŒç« åœ°å€ç±»å‹é‚£ä¸€èŠ‚æœ‰è¯¦ç»†çš„ä»‹ç»

- ä½¿ç”¨ [call](/source/02.type-of-data.html#call)
- ä½¿ç”¨ [delegatecall](/source/02.type-of-data.html#delegatecall)
- ä½¿ç”¨ [staticcall](/source/02.type-of-data.html#staticcall)

**call æ ¸å¿ƒä»£ç å¦‚ä¸‹**

```
bytes memory data = abi.encodeWithSignature(
    "setNameAndAge(string,uint256)",
    _name,
    _age
);
(bool success, bytes memory _bys) = _ads.call{value: msg.value}(data);
require(success, "Call Failed");
bys = _bys;
```

ç”¨ç»™å®šçš„æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰å‘å‡ºä½çº§ `CALL` è°ƒç”¨ï¼Œå¹¶**è¿”å›äº¤æ˜“æˆåŠŸçŠ¶æ€å’Œè¿”å›æ•°æ®**ï¼ˆè°ƒç”¨åˆçº¦çš„æ–¹æ³•å¹¶è½¬è´¦ï¼‰, æ ¼å¼å¦‚ä¸‹ï¼š

```
<address>.call(bytes memory) returns (bool, bytes memory)
```

**DelegateCall æ ¸å¿ƒä»£ç å¦‚ä¸‹**
- å§”æ‰˜è°ƒç”¨åï¼Œæ‰€æœ‰å˜é‡ä¿®æ”¹éƒ½æ˜¯å‘ç”Ÿåœ¨å§”æ‰˜åˆçº¦å†…éƒ¨ï¼Œå¹¶ä¸ä¼šä¿å­˜åœ¨è¢«å§”æ‰˜åˆçº¦ä¸­ã€‚
  - åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥é€šè¿‡æ›´æ¢è¢«å§”æ‰˜åˆçº¦ï¼Œæ¥å‡çº§å§”æ‰˜åˆçº¦ã€‚
- å§”æ‰˜è°ƒç”¨åˆçº¦å†…éƒ¨ï¼Œéœ€è¦å’Œè¢«å§”æ‰˜åˆçº¦çš„å†…éƒ¨å‚æ•°å®Œå…¨ä¸€æ ·ï¼Œå¦åˆ™å®¹æ˜“å¯¼è‡´æ•°æ®æ··ä¹±
  - å¯ä»¥é€šè¿‡é¡ºåºæ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯æ¨èå®Œå…¨ä¸€æ ·


```
function set(address _ads, uint256 _num) external payable {
    sender = msg.sender;
    value = msg.value;
    num = _num;
    // ç¬¬1ç§ encode
    // ä¸éœ€çŸ¥é“åˆçº¦åå­—ï¼Œå‡½æ•°å®Œå…¨è‡ªå®šä¹‰
    bytes memory data1 = abi.encodeWithSignature("set(uint256)", _num);
    // ç¬¬2ç§ encode
    // éœ€è¦åˆçº¦åå­—ï¼Œå¯ä»¥é¿å…å‡½æ•°å’Œå‚æ•°å†™é”™
    // bytes memory data2 = abi.encodeWithSelector(Test1.set.selector, _num);

    (bool success, bytes memory _data) = _ads.delegatecall(data1);

    require(success, "DelegateCall set failed");
}
```

**staticcall æ ¸å¿ƒä»£ç å¦‚ä¸‹**: å®ƒä¸ call åŸºæœ¬ç›¸åŒï¼Œ**ä½†å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹çŠ¶æ€å˜é‡ï¼Œéƒ½å°†å›é€€**ã€‚

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

// è¢«è°ƒç”¨çš„åˆçº¦
contract Hello {
    function echo() external pure returns (string memory) {
        return "Hello World!";
    }
}

// è°ƒç”¨è€…åˆçº¦
contract SoldityTest {
    function callHello(address _ads) external view returns (string memory) {
        // ç¼–ç è¢«è°ƒç”¨è€…çš„æ–¹æ³•ç­¾å
        bytes4 methodId = bytes4(keccak256("echo()"));

        // è°ƒç”¨åˆçº¦
        (bool success, bytes memory data) = _ads.staticcall(
            abi.encodeWithSelector(methodId)
        );
        if (success) {
            return abi.decode(data, (string));
        } else {
            return "error";
        }
    }
}
```

## 3ï¸âƒ£ MultiCall/å¤šæ¬¡è°ƒç”¨

- æŠŠå¤šä¸ªåˆçº¦çš„å¤šæ¬¡å‡½æ•°çš„è°ƒç”¨ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªé‡Œé¢å¯¹åˆçº¦è¿›è¡Œè°ƒç”¨ã€‚RPC å¯¹è°ƒç”¨æœ‰é™åˆ¶ï¼Œè¿™æ ·å¯ä»¥ç»•å¼€é™åˆ¶ã€‚
- å¤šæ¬¡è°ƒç”¨é‡Œé¢ï¼Œå¯¹æ–¹çš„å†…éƒ¨, `msg.sender` æ˜¯ MultiCall åˆçº¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·åœ°å€ã€‚

### è¯´æ˜

- è°ƒç”¨çš„åœ°å€
- è°ƒç”¨çš„ data

### åˆçº¦ä»£ç 

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract Test {
    function fn1()
        external
        view
        returns (
            uint256,
            address,
            uint256
        )
    {
        return (1, msg.sender, block.timestamp);
    }

    function fn2()
        external
        view
        returns (
            uint256,
            address,
            uint256
        )
    {
        return (2, msg.sender, block.timestamp);
    }

    function getFn1Data() external pure returns (bytes memory) {
        // ä¸¤ç§ç­¾åæ–¹æ³•éƒ½å¯ä»¥
        // abi.encodeWithSignature("fn1()");
        return abi.encodeWithSelector(this.fn1.selector);
    }

    function getFn2Data() external pure returns (bytes memory) {
        return abi.encodeWithSelector(this.fn2.selector);
    }
}

contract MultiCall {
    function multiCall(address[] calldata targets, bytes[] calldata data)
        external
        view
        returns (bytes[] memory)
    {
        require(targets.length == data.length, "targets.length != data.length");
        bytes[] memory results = new bytes[](data.length);
        for (uint256 index = 0; index < targets.length; index++) {
            (bool success, bytes memory result) = targets[index].staticcall(
                data[index]
            );
            require(success, "call faild");
            results[index] = result;
        }
        return results;
    }
}
```

**æµ‹è¯•**

- éƒ¨ç½² `Test`: `0x1c91347f2A44538ce62453BEBd9Aa907C662b4bD`
  - ä½¿ç”¨ `getFn1Data` è·å– fn1 data
  - ä½¿ç”¨ `getFn2Data` è·å– fn2 data
- éƒ¨ç½² `MultiCall`: `0x93f8dddd876c7dBE3323723500e83E202A7C96CC`
- è°ƒç”¨ multiCall æ–¹æ³•
  - å‚æ•° 1: `["Test åœ°å€","Test åœ°å€"]`
  - å‚æ•° 2: `["fn1 data","fn2 data"]`
- è¿”å›å€¼å¦‚ä¸‹

  ```
  0x
  0000000000000000000000000000000000000000000000000000000000000001
  00000000000000000000000093f8dddd876c7dbe3323723500e83e202a7c96cc
  00000000000000000000000000000000000000000000000000000000630c7834,
  0x
  0000000000000000000000000000000000000000000000000000000000000002
  00000000000000000000000093f8dddd876c7dbe3323723500e83e202a7c96cc
  00000000000000000000000000000000000000000000000000000000630c7834
  ```

## 4ï¸âƒ£ MultiDelegatecall / å¤šæ¬¡å§”æ‰˜è°ƒç”¨

ä¸ºä»€ä¹ˆä½¿ç”¨ MultiDelegatecall ï¼Œä¸ä½¿ç”¨ MultiCall?æ˜¯ä¸ºäº†è®©è¢«è°ƒç”¨çš„åˆçº¦å†…ï¼Œ`msg.sender` æ˜¯ç”¨æˆ·åˆçº¦ï¼Œè€Œä¸æ˜¯ä¸­è½¬åˆçº¦çš„åœ°å€ã€‚

ä½†æ˜¯å§”æ‰˜è°ƒç”¨çš„ç¼ºç‚¹æ˜¯ï¼Œåˆçº¦å¿…é¡»æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œä¸èƒ½æ˜¯åˆ«äººç¼–å†™çš„ã€‚

å¤šæ¬¡å§”æ‰˜è°ƒç”¨ï¼Œå­˜åœ¨æ¼æ´ï¼Œä¸è¦åœ¨é‡Œé¢å¤šæ¬¡ç´¯åŠ ä½™é¢ã€‚æˆ–è€…å¤šé‡å§”æ‰˜ç¦æ­¢æ¥å—èµ„é‡‘ã€‚

### åˆçº¦

```
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.17;

contract MultiDelegatecall {
    function multiDelegatecall(bytes[] calldata data)
        external
        returns (bytes[] memory)
    {
        bytes[] memory results = new bytes[](data.length);
        for (uint256 index = 0; index < data.length; index++) {
            (bool success, bytes memory result) = address(this).delegatecall(
                data[index]
            );
            require(success, "call faild");
            results[index] = result;
        }
        return results;
    }
}

contract Test is MultiDelegatecall {
    function fn1()
        external
        view
        returns (
            uint256,
            address,
            uint256
        )
    {
        return (1, msg.sender, block.timestamp);
    }

    function fn2()
        external
        view
        returns (
            uint256,
            address,
            uint256
        )
    {
        return (2, msg.sender, block.timestamp);
    }

    function getFn1Data() external pure returns (bytes memory) {
        // ä¸¤ç§ç­¾åæ–¹æ³•éƒ½å¯ä»¥
        // abi.encodeWithSignature("fn1()");
        return abi.encodeWithSelector(this.fn1.selector);
    }

    function getFn2Data() external pure returns (bytes memory) {
        return abi.encodeWithSelector(this.fn2.selector);
    }
}
```

**åˆçº¦æµ‹è¯•**

- éƒ¨ç½² Test åˆçº¦
- è·å– getFn1Data: `0x648fc804`
- è·å– getFn2Data: `0x98d26a11`
- è°ƒç”¨ `multiDelegatecall`
  - ["0x648fc804","0x98d26a11"]
- å¾—åˆ° decoded outputï¼Œå‘ç°åœ°å€æ˜¯ç”¨æˆ·çš„

  ```
  0x
  0000000000000000000000000000000000000000000000000000000000000001
  0000000000000000000000005b38da6a701c568545dcfcb03fcb875f56beddc4
  00000000000000000000000000000000000000000000000000000000630c8ebc,
  0x
  0000000000000000000000000000000000000000000000000000000000000002
  0000000000000000000000005b38da6a701c568545dcfcb03fcb875f56beddc4
  00000000000000000000000000000000000000000000000000000000630c8ebc
  ```

## ğŸ†— å®æˆ˜åº”ç”¨

## #ï¸âƒ£ é—®ç­”é¢˜

- å†…éƒ¨åˆçº¦è°ƒç”¨æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ
  - **æ–¹æ³• 1**: é€šè¿‡ `ContractName(_ads)` å°†ä¼ å…¥çš„åœ°å€ï¼Œè½¬ä¸ºåˆçº¦å¯¹è±¡
    - `Test(_ads).setX(_x);`
    - å¦‚æœä¸ºäº†ä»£ç é€»è¾‘ï¼Œä¹Ÿå¯ä»¥åˆ†å¼€å†™ï¼Œæ¯”å¦‚
      ```
      Test temp = Test(_ads);
      temp.setX(_x);
      ```
  - **æ–¹æ³• 2**: å¯ä»¥é€šè¿‡å‚æ•°ä¸­æŒ‡å®šåˆçº¦åå­—è¿›è¡Œè½¬æ¢
    ```
      function setX2(Test _ads, uint256 _x) public {
          _ads.setX(_x);
      }
    ```
  - **è°ƒç”¨å¹¶å‘é€ ETH**: `fnName{value: msg.value}();`
    - `Test(_ads).setYBySendEth{value: msg.value}();`
- è°ƒç”¨å¤–éƒ¨åˆçº¦æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ
  - 1 é€šè¿‡æ¥å£æ–¹å¼è°ƒç”¨
  ```
    interface AnimalEat {
        function eat() external returns (string memory);
    }

    contract Animal {
        function test(address _addr) external returns (string memory) {
            AnimalEat general = AnimalEat(_addr);
            return general.eat();
        }
    }
  ```
  - 2 é€šè¿‡ç­¾åæ–¹å¼è°ƒç”¨(call/delegatecall/staticcall)
     - **call æ ¸å¿ƒä»£ç å¦‚ä¸‹**
      ```
      bytes memory data = abi.encodeWithSignature(
          "setNameAndAge(string,uint256)",
          _name,
          _age
      );
      (bool success, bytes memory _bys) = _ads.call{value: msg.value}(data);
      require(success, "Call Failed");
      bys = _bys;
      ```
      - ç”¨ç»™å®šçš„æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰å‘å‡ºä½çº§ `CALL` è°ƒç”¨ï¼Œå¹¶**è¿”å›äº¤æ˜“æˆåŠŸçŠ¶æ€å’Œè¿”å›æ•°æ®**ï¼ˆè°ƒç”¨åˆçº¦çš„æ–¹æ³•å¹¶è½¬è´¦ï¼‰, æ ¼å¼å¦‚ä¸‹ï¼š
      ```
      <address>.call(bytes memory) returns (bool, bytes memory)
      ```
    - **DelegateCall æ ¸å¿ƒä»£ç å¦‚ä¸‹**
      ```
      function set(address _ads, uint256 _num) external payable {
          sender = msg.sender;
          value = msg.value;
          num = _num;
          // ç¬¬1ç§ encode
          // ä¸éœ€çŸ¥é“åˆçº¦åå­—ï¼Œå‡½æ•°å®Œå…¨è‡ªå®šä¹‰
          bytes memory data1 = abi.encodeWithSignature("set(uint256)", _num);
          // ç¬¬2ç§ encode
          // éœ€è¦åˆçº¦åå­—ï¼Œå¯ä»¥é¿å…å‡½æ•°å’Œå‚æ•°å†™é”™
          // bytes memory data2 = abi.encodeWithSelector(Test1.set.selector, _num);

          (bool success, bytes memory _data) = _ads.delegatecall(data1);

          require(success, "DelegateCall set failed");
      }
      ```

    - **staticcall æ ¸å¿ƒä»£ç å¦‚ä¸‹**: å®ƒä¸ call åŸºæœ¬ç›¸åŒï¼Œ**ä½†å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°ä»¥ä»»ä½•æ–¹å¼ä¿®æ”¹çŠ¶æ€å˜é‡ï¼Œéƒ½å°†å›é€€**ã€‚
      ```
        // SPDX-License-Identifier: MIT
        pragma solidity ^0.8.17;

        // è¢«è°ƒç”¨çš„åˆçº¦
        contract Hello {
            function echo() external pure returns (string memory) {
                return "Hello World!";
            }
        }

        // è°ƒç”¨è€…åˆçº¦
        contract SoldityTest {
            function callHello(address _ads) external view returns (string memory) {
                // ç¼–ç è¢«è°ƒç”¨è€…çš„æ–¹æ³•ç­¾å
                bytes4 methodId = bytes4(keccak256("echo()"));

                // è°ƒç”¨åˆçº¦
                (bool success, bytes memory data) = _ads.staticcall(
                    abi.encodeWithSelector(methodId)
                );
                if (success) {
                    return abi.decode(data, (string));
                } else {
                    return "error";
                }
            }
        }
        ```
- MultiCall/å¤šæ¬¡è°ƒç”¨
  - æŠŠå¤šä¸ªåˆçº¦çš„å¤šæ¬¡å‡½æ•°çš„è°ƒç”¨ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªé‡Œé¢å¯¹åˆçº¦è¿›è¡Œè°ƒç”¨ã€‚RPC å¯¹è°ƒç”¨æœ‰é™åˆ¶ï¼Œè¿™æ ·å¯ä»¥ç»•å¼€é™åˆ¶ã€‚
  - å¤šæ¬¡è°ƒç”¨é‡Œé¢ï¼Œå¯¹æ–¹çš„å†…éƒ¨, `msg.sender` æ˜¯ MultiCall åˆçº¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·åœ°å€ã€‚
  ```
  contract MultiCall {
        function multiCall(address[] calldata targets, bytes[] calldata data)
            external
            view
            returns (bytes[] memory)
        {
            require(targets.length == data.length, "targets.length != data.length");
            bytes[] memory results = new bytes[](data.length);
            for (uint256 index = 0; index < targets.length; index++) {
                (bool success, bytes memory result) = targets[index].staticcall(
                    data[index]
                );
                require(success, "call faild");
                results[index] = result;
            }
            return results;
        }
    }
  ```
- MultiDelegatecall / å¤šæ¬¡å§”æ‰˜è°ƒç”¨
  - ä¸ºä»€ä¹ˆä½¿ç”¨ MultiDelegatecall ï¼Œä¸ä½¿ç”¨ MultiCall?æ˜¯ä¸ºäº†è®©è¢«è°ƒç”¨çš„åˆçº¦å†…ï¼Œ`msg.sender` æ˜¯ç”¨æˆ·åˆçº¦ï¼Œè€Œä¸æ˜¯ä¸­è½¬åˆçº¦çš„åœ°å€ã€‚ä½†æ˜¯å§”æ‰˜è°ƒç”¨çš„ç¼ºç‚¹æ˜¯ï¼Œåˆçº¦å¿…é¡»æ˜¯è‡ªå·±ç¼–å†™çš„ï¼Œä¸èƒ½æ˜¯åˆ«äººç¼–å†™çš„ã€‚å¤šæ¬¡å§”æ‰˜è°ƒç”¨ï¼Œå­˜åœ¨æ¼æ´ï¼Œä¸è¦åœ¨é‡Œé¢å¤šæ¬¡ç´¯åŠ ä½™é¢ã€‚æˆ–è€…å¤šé‡å§”æ‰˜ç¦æ­¢æ¥å—èµ„é‡‘ã€‚
    ```
    // SPDX-License-Identifier: MIT
    pragma solidity ^0.8.17;

    contract MultiDelegatecall {
        function multiDelegatecall(bytes[] calldata data)
            external
            returns (bytes[] memory)
        {
            bytes[] memory results = new bytes[](data.length);
            for (uint256 index = 0; index < data.length; index++) {
                (bool success, bytes memory result) = address(this).delegatecall(
                    data[index]
                );
                require(success, "call faild");
                results[index] = result;
            }
            return results;
        }
    }

    contract Test is MultiDelegatecall {
        function fn1()
            external
            view
            returns (
                uint256,
                address,
                uint256
            )
        {
            return (1, msg.sender, block.timestamp);
        }

        function fn2()
            external
            view
            returns (
                uint256,
                address,
                uint256
            )
        {
            return (2, msg.sender, block.timestamp);
        }

        function getFn1Data() external pure returns (bytes memory) {
            // ä¸¤ç§ç­¾åæ–¹æ³•éƒ½å¯ä»¥
            // abi.encodeWithSignature("fn1()");
            return abi.encodeWithSelector(this.fn1.selector);
        }

        function getFn2Data() external pure returns (bytes memory) {
            return abi.encodeWithSelector(this.fn2.selector);
        }
    }
    ```
